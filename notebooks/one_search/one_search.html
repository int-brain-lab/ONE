<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Searching with ONE &mdash; ONE  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Listing with ONE" href="../one_list/one_list.html" />
    <link rel="prev" title="ONE Quick Start" href="../one_quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ONE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using ONE to access data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../one_reference.html">Introduction to ONE (Open Neurophysiology Environment)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../one_installation.html">ONE installation and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Searching with ONE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Advanced-searching">Advanced searching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Gotchas">Gotchas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Difference-between-search-term-behaviours">Difference between search term behaviours</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Difference-between-remote-mode-search-terms">Difference between remote mode search terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-dataset,-datasets-and-dataset_types-remote-arguments">The dataset, datasets and dataset_types remote arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Regex-systems-between-modes">Regex systems between modes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Searching-data-with-a-release-tag">Searching data with a release tag</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Searching-insertions">Searching insertions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../one_list/one_list.html">Listing with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../one_load/one_load.html">Loading with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experiment_ids.html">Experiment IDs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE with Alyx</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../one_modes.html">ONE API modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../one_advanced/one_advanced.html">ONE REST queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_alyx_queries.html">Useful Alyx REST queries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE to share data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_sharing.html">Releasing data with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recording_data_access.html">Recording data access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ALF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../alf_intro.html">ALyx Filenames (ALF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../alyx_files.html">Listing Alyx Filenames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets_and_types.html">Datasets and their types</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ONE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Searching with ONE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/one_search/one_search.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <a href="one_search.ipynb"><button id="download">Download tutorial notebook</button></a>
<a href="https://github.com/int-brain-lab/ONE/tree/main/docs/notebooks/one_search/
one_search.ipynb"><button id="github">Github link</button></a><section id="Searching-with-ONE">
<h1>Searching with ONE<a class="headerlink" href="#Searching-with-ONE" title="Link to this heading"></a></h1>
<p>ONE contains a method that allows you to search for sessions of interest. The possible search terms can be listed using,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://openalyx.internationalbrainlab.org&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">one</span><span class="o">.</span><span class="n">search_terms</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;dataset&#39;, &#39;date_range&#39;, &#39;laboratory&#39;, &#39;number&#39;, &#39;projects&#39;, &#39;subject&#39;, &#39;task_protocol&#39;)
</pre></div></div>
</div>
<p>We can search for sessions within a specified date range (inclusive)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-01&#39;</span><span class="p">])</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">eids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;ef91b4d0-02a3-48c4-b6ad-610d346e5f68&#39;, &#39;b4e3383c-6cdb-49af-81a1-39b8f88aa5fd&#39;]
</pre></div></div>
</div>
<p>A single date can be provided instead of a range. Also to define only the upper or lower date bound, set the other element to None.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-01&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To get more information about the sessions we can add a details=True flag</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eids</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-01&#39;</span><span class="p">],</span> <span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;date&#39;: datetime.date(2021, 1, 1),
  &#39;lab&#39;: &#39;wittenlab&#39;,
  &#39;number&#39;: 2,
  &#39;projects&#39;: &#39;witten_learning_dop&#39;,
  &#39;subject&#39;: &#39;fip_12&#39;,
  &#39;task_protocol&#39;: &#39;_iblrig_tasks_FPChoiceWorld6.4.2&#39;},
 {&#39;date&#39;: datetime.date(2021, 1, 1),
  &#39;lab&#39;: &#39;wittenlab&#39;,
  &#39;number&#39;: 2,
  &#39;projects&#39;: &#39;witten_learning_dop&#39;,
  &#39;subject&#39;: &#39;fip_11&#39;,
  &#39;task_protocol&#39;: &#39;_iblrig_tasks_FP_biasedChoiceWorld6.4.2&#39;}]
</pre></div></div>
</div>
<p>Multiple search terms can also be combined, for example we can search for any sessions from the subject SWC_043 that contain the datasets spikes.times and spikes.clusters</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;SWC_043&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">,</span> <span class="s1">&#39;spikes.clusters&#39;</span><span class="p">])</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">eids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;4ecb5d24-f5cc-402c-be28-9d0f7cb14b3a&#39;,
 &#39;c6db3304-c906-400c-aa0f-45dd3945b2ea&#39;,
 &#39;88d24c31-52e4-49cc-9f32-6adbeb9eba87&#39;,
 &#39;6fb1e12c-883b-46d1-a745-473cde3232c8&#39;,
 &#39;695a6073-eae0-49e0-bb0f-e9e57a9275b9&#39;,
 &#39;6f09ba7e-e3ce-44b0-932b-c003fb44fb89&#39;,
 &#39;f3ce3197-d534-4618-bf81-b687555d1883&#39;]
</pre></div></div>
</div>
<p>More search terms are available when making <a class="reference external" href="../one_modes.html">remote queries</a> (using the remote Alyx database instead of the local cache). You can view all the remote search terms with the ‘remote’ arg:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one</span><span class="o">.</span><span class="n">search_terms</span><span class="p">(</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">performance_gte</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Warning.</p>
<p>Remote search queries behave slightly differently. See “Gochas” below.</p>
</div>
<p>Search term arguments may be shortened, so long as they are not ambiguous:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">task_protocol</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">one.search(dat='2020-01-01')</span></code> will raise a ValueError as ‘dat’ could be short for both ‘date_range’ and ‘dataset’.</p>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Warning.</p>
<p>There are more search terms when using remote mode, for example ‘data’ can match both ‘dataset’ and ‘datasets’ in remote mode.</p>
</div>
<p>To find out more information about the <code class="docutils literal notranslate"><span class="pre">one.search</span></code> method we can use the help function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on method search in module one.api:

search(details=False, query_type=None, **kwargs) method of one.api.OneAlyx instance
    Searches sessions matching the given criteria and returns a list of matching eids.

    For a list of search terms, use the method

        one.search_terms(query_type=&#39;remote&#39;)

    For all of the search parameters, a single value or list may be provided.  For `dataset`,
    the sessions returned will contain all listed datasets.  For the other parameters,
    the session must contain at least one of the entries.

    For all but `date_range` and `number`, any field that contains the search string is
    returned.  Wildcards are not permitted, however if wildcards property is True, regular
    expressions may be used (see notes and examples).

    Parameters
    ----------
    dataset : str
        A (partial) dataset name. Returns sessions containing matching datasets.
        A dataset matches if it contains the search string e.g. &#39;wheel.position&#39; matches
        &#39;_ibl_wheel.position.npy&#39;. C.f. `datasets` argument.
    date_range : str, list, datetime.datetime, datetime.date, pandas.timestamp
        A single date to search or a list of 2 dates that define the range (inclusive).  To
        define only the upper or lower date bound, set the other element to None.
    lab : str, list
        A str or list of lab names, returns sessions from any of these labs (can be partial,
        i.e. any task protocol containing that str will be found).
    number : str, int
        Number of session to be returned, i.e. number in sequence for a given date.
    subject : str, list
        A list of subject nicknames, returns sessions for any of these subjects (can be
        partial, i.e. any task protocol containing that str will be found).
    task_protocol : str, list
        The task protocol name (can be partial, i.e. any task protocol containing that str
        will be found).
    project(s) : str, list
        The project name (can be partial, i.e. any task protocol containing that str
        will be found).
    performance_lte / performance_gte : float
        Search only for sessions whose performance is less equal or greater equal than a
        pre-defined threshold as a percentage (0-100).
    users : str, list
        A list of users.
    location : str, list
        A str or list of lab location (as per Alyx definition) name.
        Note: this corresponds to the specific rig, not the lab geographical location per se.
    dataset_types : str, list
        One or more of dataset_types.
    datasets : str, list
        One or more (exact) dataset names. Returns insertions containing all of these datasets.
    details : bool
        If true also returns a dict of dataset details.
    query_type : str, None
        Query cache (&#39;local&#39;) or Alyx database (&#39;remote&#39;).
    limit : int
        The number of results to fetch in one go (if pagination enabled on server).

    Returns
    -------
    list
        List of eids.
    (list of dicts)
        If details is True, also returns a list of dictionaries, each entry corresponding to a
        matching session.

    Examples
    --------
    Search for sessions with &#39;training&#39; in the task protocol.

    &gt;&gt;&gt; eids = one.search(task=&#39;training&#39;)

    Search for sessions by subject &#39;MFD_04&#39;.

    &gt;&gt;&gt; eids = one.search(subject=&#39;MFD_04&#39;)

    Do an exact search for sessions by subject &#39;FD_04&#39;.

    &gt;&gt;&gt; assert one.wildcards is True, &#39;the wildcards flag must be True for regex expressions&#39;
    &gt;&gt;&gt; eids = one.search(subject=&#39;^FD_04$&#39;, query_type=&#39;local&#39;)

    Search for sessions on a given date, in a given lab, containing trials and spike data.

    &gt;&gt;&gt; eids = one.search(date=&#39;2023-01-01&#39;, lab=&#39;churchlandlab&#39;, dataset=[&#39;trials&#39;, &#39;spikes&#39;])

    Notes
    -----
    - In default and local mode, most queries are case-sensitive partial matches. When lists
      are provided, the search is a logical OR, except for `datasets`, which is a logical AND.
    - All search terms are true for a session to be returned, i.e. subject matches AND project
      matches, etc.
    - In remote mode most queries are case-insensitive partial matches.
    - In default and local mode, when the one.wildcards flag is True (default), queries are
      interpreted as regular expressions. To turn this off set one.wildcards to False.
    - In remote mode regular expressions are only supported using the `django` argument.
</pre></div></div>
</div>
<section id="Advanced-searching">
<h2>Advanced searching<a class="headerlink" href="#Advanced-searching" title="Link to this heading"></a></h2>
<p>By default ONE searches most terms function as an LIKE OR expression, returning results that contain any of the search values as a substring. For example <code class="docutils literal notranslate"><span class="pre">one.search(subject=['foo',</span> <span class="pre">'bar'])</span></code> returns all sessions where the subject name contains ‘foo’ or contains ‘bar’. The exception is the dataset search term, which is a LIKE AND expression, i.e. the session must contain one or more dataset names containing ‘foo’ AND one or more datasets containing ‘bar’. Note that all expressions are
case-sensitive in auto/local mode and case-insensitive in remote mode.</p>
<p>For more precise searches, regular expressions (a.k.a. regex) can be used. This is on by default and can be deactivated by setting the wildcards flag: <code class="docutils literal notranslate"><span class="pre">one.wildcards</span> <span class="pre">=</span> <span class="pre">False</span></code> (note that this also affects the list and load methods, see <a class="reference external" href="../one_load/one_load.html#Advanced-loading">the advanced loading section of Loading with ONE</a> for more details).</p>
<p>Regex allows one to make exact searches by asserting the start and end of the string:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;FD_04&#39;</span><span class="p">)</span>  <span class="c1"># includes sessions with subject &#39;MFD_04&#39;</span>
<span class="k">assert</span> <span class="n">one</span><span class="o">.</span><span class="n">wildcards</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;the wildcards flag must be True for regex expressions&#39;</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;^FD_04$&#39;</span><span class="p">)</span>  <span class="c1"># exact subject name match</span>
</pre></div>
</div>
</div>
<p>Likewise, to search for sessions that include one dataset OR another, we can use the <code class="docutils literal notranslate"><span class="pre">|</span></code> character in our regex:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sessions containing either leftCamera.times OR rightCamera.times:</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;leftCamera\.times|rightCamera\.times&#39;</span><span class="p">)</span>
<span class="c1"># XOR expressions are also possible:</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;(leftCamera\.times|rightCamera\.times)</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\User\Documents\Github\ONE\one\api.py:460: UserWarning: This pattern is interpreted as a regular expression, and has match groups. To actually get the groups, use str.extract.
  return all(any(x.str.contains(y, regex=self.wildcards) &amp; exists) for y in dsets)
</pre></div></div>
</div>
<p>Note that the wildcards flag causes certain characters to be interpreted differently (e.g. <code class="docutils literal notranslate"><span class="pre">.</span></code> matches any character). To avoid this, either set the wildcards flag to False or escape the string using <code class="docutils literal notranslate"><span class="pre">re.escape</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;NYU-14.1&#39;</span>
<span class="k">if</span> <span class="n">one</span><span class="o">.</span><span class="n">wildcards</span><span class="p">:</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">)</span>  <span class="c1"># &#39;NYU\\-14\\.1&#39;</span>
</pre></div>
</div>
</div>
<section id="Gotchas">
<h3>Gotchas<a class="headerlink" href="#Gotchas" title="Link to this heading"></a></h3>
<p>ONE.search strikes a balance between usability, functionality, and stability. We have been careful to ensure that the results of the search function have remained consistent across versions, however there are some confusing and unintuitive behaviours as a result…</p>
<section id="Difference-between-search-term-behaviours">
<h4>Difference between search term behaviours<a class="headerlink" href="#Difference-between-search-term-behaviours" title="Link to this heading"></a></h4>
<p>As mentioned above, different search terms perform differently. Below are the search terms and their approximate SQL equivalents:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>Lookup</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dataset</p></td>
<td><p>LIKE AND</p></td>
</tr>
<tr class="row-odd"><td><p>number</p></td>
<td><p>EXACT</p></td>
</tr>
<tr class="row-even"><td><p>date_range</p></td>
<td><p>BETWEEN</p></td>
</tr>
<tr class="row-odd"><td><p>subject, etc.</p></td>
<td><p>LIKE OR</p></td>
</tr>
</tbody>
</table>
<p>Combinations of terms form a logical AND, for example <code class="docutils literal notranslate"><span class="pre">one.search(subject=['foo',</span> <span class="pre">'bar'],</span> <span class="pre">project='baz')</span></code> searches for sessions where the subject name contains foo OR bar, AND the project contains baz.</p>
</section>
<section id="Difference-between-remote-mode-search-terms">
<h4>Difference between remote mode search terms<a class="headerlink" href="#Difference-between-remote-mode-search-terms" title="Link to this heading"></a></h4>
<p>Many search terms perform differently between auto/local mode and <a class="reference external" href="../one_modes.html">remote mode</a>, namely in remote mode, search queries are case-insensitive.</p>
</section>
<section id="The-dataset,-datasets-and-dataset_types-remote-arguments">
<h4>The dataset, datasets and dataset_types remote arguments<a class="headerlink" href="#The-dataset,-datasets-and-dataset_types-remote-arguments" title="Link to this heading"></a></h4>
<p>In remote mode there are three ways to search for datasets:</p>
<ul class="simple">
<li><p><strong>dataset</strong> - a partial, case-insensitive match of a single dataset (multiple datasets not supported).</p></li>
<li><p><strong>datasets</strong> - an exact, case-sensitive match of one or more datasets. All datasets must be present.</p></li>
<li><p><strong>dataset_type</strong> - an exact, case-sensitive match of one or more <a class="reference external" href="../datasets_and_types.html#Dataset-types">dataset types</a>. All dataset types must be present.</p></li>
</ul>
</section>
<section id="Regex-systems-between-modes">
<h4>Regex systems between modes<a class="headerlink" href="#Regex-systems-between-modes" title="Link to this heading"></a></h4>
<p>Regex searches can be made in remote mode by using special <a class="reference external" href="../useful_alyx_queries.html#regex">Django queries</a>, for example,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eids = one.search(django=&#39;subject__nickname__regex,^FD_04$&#39;, query_type=&#39;remote&#39;)
</pre></div>
</div>
<p>Regular expression syntax is different between modes, however: in remote mode the regex is parsed by a <a class="reference external" href="https://www.postgresql.org/docs/current/functions-matching.html">PostgreSQL</a> database, while in other modes it is done using Python’s <a class="reference external" href="https://docs.python.org/3/library/re.html#regular-expression-syntax">re.search</a>.</p>
</section>
</section>
</section>
<section id="Searching-data-with-a-release-tag">
<h2>Searching data with a release tag<a class="headerlink" href="#Searching-data-with-a-release-tag" title="Link to this heading"></a></h2>
<p>Datasets associated with a given paper and/or data release are associated with a tag. You can list the available release tags like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">one</span><span class="o">.</span><span class="n">offline</span><span class="p">,</span> <span class="s1">&#39;ONE must be online to query tags&#39;</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021_Q1_IBL_et_al_Behaviour: https://doi.org/10.7554/eLife.63711
2021_Q2_PreRelease: https://figshare.com/articles/online_resource/Spike_sorting_pipeline_for_the_International_Brain_Laboratory/19705522/3
2021_Q2_Varol_et_al: https://doi.org/10.1109/ICASSP39728.2021.9414145
2021_Q3_Whiteway_et_al: https://doi.org/10.1371/journal.pcbi.1009439
2022_Q2_IBL_et_al_RepeatedSite: https://doi.org/10.1101/2022.05.09.491042
2022_Q3_IBL_et_al_DAWG: https://doi.org/10.1101/827873
2022_Q4_IBL_et_al_BWM: https://figshare.com/articles/preprint/Data_release_-_Brainwide_map_-_Q4_2022/21400815
2023_Q1_Biderman_Whiteway_et_al:
2023_Q1_Mohammadi_et_al:
</pre></div></div>
</div>
<p>You can download a cache table for any given release tag, allowing you to restrict your ONE.search queries to a given tag in <a class="reference external" href="../one_modes">auto/local mode</a>. See FAQ section ‘<a class="reference external" href="../../FAQ.html#how-do-i-download-the-datasets-cache-for-a-specific-ibl-paper-release">How do I download the datasets cache for a specific IBL paper release?</a>’ for more information.</p>
<p>To search for session containing datasets assocaited with a given release tag in <a class="reference external" href="../one_modes">remote mode</a>, you can use the following query parameter:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;2021_Q1_IBL_et_al_Behaviour&#39;</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">django</span><span class="o">=</span><span class="s1">&#39;data_dataset_session_related__tags__name,&#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Searching-insertions">
<h2>Searching insertions<a class="headerlink" href="#Searching-insertions" title="Link to this heading"></a></h2>
<p>A session may contain multiple insertions recording different brain areas. To find data associated with a specific brain area, it is useful to search by insertion instead of by session.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">OneAlyx.search_insertions</span></code> method takes similar arguments to the remote search method, and returns a list of probe UUIDs (pIDs), which can be interconverted with session IDs (eIDs) for <a class="reference external" href="../one_load/one_load.html#Load-spike-times-from-a-probe-UUID">loading data</a>.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note.</p>
<p>The search_insertions method is only available in <a class="reference external" href="../one_modes">remote mode</a>.</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one</span><span class="o">.</span><span class="n">search_terms</span><span class="p">(</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;insertions&#39;</span><span class="p">)</span>
<span class="n">pids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search_insertions</span><span class="p">(</span><span class="n">atlas_acronym</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;STR&#39;</span><span class="p">,</span> <span class="s1">&#39;CA3&#39;</span><span class="p">],</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>For searching insertions associated with a given release tag, see the <a class="reference external" href="../../_autosummary/one.api.html#one.api.OneAlyx.search_insertions">method examples</a> by typing <code class="docutils literal notranslate"><span class="pre">help(one.search_insertions)</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../one_quickstart.html" class="btn btn-neutral float-left" title="ONE Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../one_list/one_list.html" class="btn btn-neutral float-right" title="Listing with ONE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, International Brain Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>