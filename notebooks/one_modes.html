<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ONE API modes &mdash; ONE  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ONE REST queries" href="one_advanced/one_advanced.html" />
    <link rel="prev" title="Experiment IDs" href="experiment_ids.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ONE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using ONE to access data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../one_reference.html">Introduction to ONE (Open Neurophysiology Environment)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../one_installation.html">ONE installation and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="one_search/one_search.html">Searching with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="one_list/one_list.html">Listing with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="one_load/one_load.html">Loading with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiment_ids.html">Experiment IDs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE with Alyx</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ONE API modes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Online-vs-Offline">Online vs Offline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Query-modes">Query modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#REST-caching">REST caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Refreshing-the-cache-tables">Refreshing the cache tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="one_advanced/one_advanced.html">ONE REST queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="useful_alyx_queries.html">Useful Alyx REST queries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE to share data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_sharing.html">Releasing data with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording_data_access.html">Recording data access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ALF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../alf_intro.html">ALyx Filenames (ALF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="alyx_files.html">Listing Alyx Filenames</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets_and_types.html">Datasets and their types</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html#contributing-to-code">Contributing to code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ONE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ONE API modes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/one_modes.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <a href="one_modes.ipynb"><button id="download">Download tutorial notebook</button></a>
<a href="https://github.com/int-brain-lab/ONE/tree/main/docs/notebooks/
one_modes.ipynb"><button id="github">Github link</button></a><section id="ONE-API-modes">
<h1>ONE API modes<a class="headerlink" href="#ONE-API-modes" title="Link to this heading"></a></h1>
<section id="Online-vs-Offline">
<h2>Online vs Offline<a class="headerlink" href="#Online-vs-Offline" title="Link to this heading"></a></h2>
<p>ONE can be instantiated in either the online and offline state. When online, ONE can query the Alyx database to retrieve information about dataset types , search with metadata such as session QC, task performance, histology and session narrative. Advanced queries may also be made <a class="reference external" href="./one_advanced/one_advanced.html">via REST</a>. Other online methods include <code class="docutils literal notranslate"><span class="pre">pid2eid</span></code> and <code class="docutils literal notranslate"><span class="pre">describe_revision</span></code>.</p>
<p>When the mode is not specified, it is usually set to ‘auto’, unless a cache_dir is specified for which no database has been configured.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">one.webclient</span> <span class="k">as</span> <span class="nn">webclient</span>
<span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>  <span class="c1"># online, &#39;auto&#39; mode</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">one</span><span class="o">.</span><span class="n">offline</span>

<span class="n">one_offline</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\data&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">one_offline</span><span class="p">,</span> <span class="n">one_offline</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>  <span class="c1"># offline, &#39;local&#39; mode</span>
<span class="k">assert</span> <span class="n">one_offline</span><span class="o">.</span><span class="n">offline</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
One (online, https://alyx.internationalbrainlab.org) auto
One (offline, C:\data) local
</pre></div></div>
</div>
</section>
<section id="Query-modes">
<h2>Query modes<a class="headerlink" href="#Query-modes" title="Link to this heading"></a></h2>
<p>In ‘auto’ mode, the list, search and load methods will use the local cache tables and not connect to Alyx, however the option to use Alyx is always there. If the cache tables can’t be downloaded from Alyx, or authentication fails, the mode will fall back to ‘local’.</p>
<p>If ‘remote’ mode is specified, ONE will only query the remote database and will not use the local cache tables. Avoiding the database whenever possible is recommended as it doesn’t rely on a stable internet connection and reduces the load on the remote Alyx.</p>
<p>While in ‘remote’ mode, the local cache may be used by providing the query_type=’local’ keyword argument to any method. Likewise, in ‘auto’/’local’ mode, a remote query can be made by specifying <code class="docutils literal notranslate"><span class="pre">query_type='remote'</span></code></p>
<div class="admonition note">
<p>NB: The ‘remote’ query type is not valid in offline mode as there is no database associated to the local cache directory.</p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;cortexlab&#39;</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>  <span class="c1"># Search Alyx instead of the local cache</span>
</pre></div>
</div>
</div>
</section>
<section id="REST-caching">
<h2>REST caching<a class="headerlink" href="#REST-caching" title="Link to this heading"></a></h2>
<p>In remote mode ONE makes a REST query instead of using the local cache tables. The results of the remote REST queries are also cached for 24 hours. This means that making the same remote REST query twice in a row will only hit the database once. The default cache expiry can be set by changing the relevant AlyxClient property:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">default_expiry</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># Cache results for up to 20 days</span>
</pre></div>
</div>
</div>
<p>You can temporarily deactivate the REST cache using the <code class="docutils literal notranslate"><span class="pre">no_cache</span></code> function in <code class="docutils literal notranslate"><span class="pre">one.webclient</span></code>. When in this context no REST responses are cached and any existing cache files are not used. Use this when the most up-to-date information is required:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">webclient</span><span class="o">.</span><span class="n">no_cache</span><span class="p">(</span><span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="p">):</span>
    <span class="n">eids</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;cortexlab&#39;</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>When calling the alyx <code class="docutils literal notranslate"><span class="pre">rest</span></code> method directly you can deactivate the cache with the <code class="docutils literal notranslate"><span class="pre">no_cache</span></code> keyword argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ses</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">lab</span><span class="o">=</span><span class="s1">&#39;cortexlab&#39;</span><span class="p">,</span> <span class="n">no_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Caching greatly improves performance and should be used whenever possible. For more information on ONE REST queries, see <a class="reference external" href="./one_advanced/one_advanced.html">this guide</a>.</p>
<p>You can turn off REST caching when instantiating ONE with the <code class="docutils literal notranslate"><span class="pre">cache_rest</span></code> keyword argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">cache_rest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Refreshing-the-cache-tables">
<h2>Refreshing the cache tables<a class="headerlink" href="#Refreshing-the-cache-tables" title="Link to this heading"></a></h2>
<p>By default ONE will try to update the cache tables once every 24 hours. This can be set by changing the ‘cache_expiry’ property:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="n">one</span><span class="o">.</span><span class="n">cache_expiry</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Check for new remote cache every hour</span>

<span class="c1"># The time when the cache was generated can be found in the cache metadata:</span>
<span class="n">one</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">_meta</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>Out[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;expired&#39;: False,
 &#39;created_time&#39;: datetime.datetime(2021, 9, 14, 13, 0),
 &#39;loaded_time&#39;: datetime.datetime(2021, 9, 14, 18, 15, 54, 384591),
 &#39;raw&#39;: {&#39;datasets&#39;: {&#39;date_created&#39;: &#39;2021-09-14 13:00&#39;, &#39;origin&#39;: &#39;alyx&#39;},
  &#39;sessions&#39;: {&#39;date_created&#39;: &#39;2021-09-14 13:00&#39;, &#39;origin&#39;: &#39;alyx&#39;}}}
</pre></div></div>
</div>
<p>Note that the cache won’t be downloaded if the remote cache hasn’t been updated since the last download. The cache can be explicitly refreshed in two ways:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_time</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">refresh_cache</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>  <span class="c1"># Explicitly refresh the cache</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;cortexlab&#39;</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span>  <span class="c1"># Calls `refresh_cache` before searching</span>
</pre></div>
</div>
</div>
</section>
<section id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Link to this heading"></a></h2>
<p>Mode overview:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Mode</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>local</p></td>
<td><p>only use current cache tables i.e. work entirely offline*</p></td>
</tr>
<tr class="row-odd"><td><p>remote</p></td>
<td><p>make REST queries instead of using cache tables</p></td>
</tr>
<tr class="row-even"><td><p>auto</p></td>
<td><p>use cache tables wherever possible and keep them updated</p></td>
</tr>
<tr class="row-odd"><td><p>refresh</p></td>
<td><p>always check for new cache tables</p></td>
</tr>
</tbody>
</table>
<p>*no remote cache tables are downloaded; local cache files must be present in this mode.</p>
<p><strong>I want to make a REST query for up-to-the-minute information</strong> Use <code class="docutils literal notranslate"><span class="pre">one.alyx.rest(...,</span> <span class="pre">no_cache=True)</span></code>.</p>
<p><strong>I want to use a remote ONE query with up-to-the-minute information</strong> Call the ONE method from within the <code class="docutils literal notranslate"><span class="pre">webclient.no_cache</span></code> context.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="experiment_ids.html" class="btn btn-neutral float-left" title="Experiment IDs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="one_advanced/one_advanced.html" class="btn btn-neutral float-right" title="ONE REST queries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, International Brain Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>