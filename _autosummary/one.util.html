<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>one.util &mdash; ONE  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="one.util.QC_TYPE" href="one.util.QC_TYPE.html" />
    <link rel="prev" title="one.tests.util" href="one.tests.util.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ONE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using ONE to access data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../one_reference.html">Introduction to ONE (Open Neurophysiology Environment)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../one_installation.html">ONE installation and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_search/one_search.html">Searching with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_list/one_list.html">Listing with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_load/one_load.html">Loading with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/experiment_ids.html">Experiment IDs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE with Alyx</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_modes.html">ONE API modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/one_advanced/one_advanced.html">ONE REST queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/useful_alyx_queries.html">Useful Alyx REST queries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using ONE to share data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/data_sharing.html">Releasing data with ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/recording_data_access.html">Recording data access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ALF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../alf_intro.html">ALyx Filenames (ALF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/alyx_files.html">Listing Alyx Filenames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/datasets_and_types.html">Datasets and their types</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="one.html">one</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="one.alf.html">one.alf</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.api.html">one.api</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.converters.html">one.converters</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.params.html">one.params</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.registration.html">one.registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.remote.html">one.remote</a></li>
<li class="toctree-l3"><a class="reference internal" href="one.tests.html">one.tests</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">one.util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="one.util.QC_TYPE.html">one.util.QC_TYPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.QC_TYPE"><code class="docutils literal notranslate"><span class="pre">QC_TYPE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.Listable"><code class="docutils literal notranslate"><span class="pre">Listable()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.ses2records"><code class="docutils literal notranslate"><span class="pre">ses2records()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.datasets2records"><code class="docutils literal notranslate"><span class="pre">datasets2records()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.parse_id"><code class="docutils literal notranslate"><span class="pre">parse_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.refresh"><code class="docutils literal notranslate"><span class="pre">refresh()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.validate_date_range"><code class="docutils literal notranslate"><span class="pre">validate_date_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.filter_datasets"><code class="docutils literal notranslate"><span class="pre">filter_datasets()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.filter_revision_last_before"><code class="docutils literal notranslate"><span class="pre">filter_revision_last_before()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.index_last_before"><code class="docutils literal notranslate"><span class="pre">index_last_before()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.autocomplete"><code class="docutils literal notranslate"><span class="pre">autocomplete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.ensure_list"><code class="docutils literal notranslate"><span class="pre">ensure_list()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.LazyId"><code class="docutils literal notranslate"><span class="pre">LazyId</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.cache_int2str"><code class="docutils literal notranslate"><span class="pre">cache_int2str()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#one.util.patch_cache"><code class="docutils literal notranslate"><span class="pre">patch_cache()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="one.webclient.html">one.webclient</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html#contributing-to-code">Contributing to code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ONE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="one.html">one</a></li>
      <li class="breadcrumb-item active">one.util</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/one.util.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-one.util">
<span id="one-util"></span><h1>one.util<a class="headerlink" href="#module-one.util" title="Link to this heading"></a></h1>
<p>Decorators and small standalone functions for api module.</p>
<p class="rubric">Module attributes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="one.util.QC_TYPE.html#one.util.QC_TYPE" title="one.util.QC_TYPE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QC_TYPE</span></code></a></p></td>
<td><p>The cache table QC column data type.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.Listable" title="one.util.Listable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Listable</span></code></a></p></td>
<td><p>Return a typing.Union if the input and sequence of input.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.autocomplete" title="one.util.autocomplete"><code class="xref py py-obj docutils literal notranslate"><span class="pre">autocomplete</span></code></a></p></td>
<td><p>Validate search term and return complete name, e.g. autocomplete('subj') == 'subject'.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.cache_int2str" title="one.util.cache_int2str"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cache_int2str</span></code></a></p></td>
<td><p>Convert int ids to str ids for cache table.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.datasets2records" title="one.util.datasets2records"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datasets2records</span></code></a></p></td>
<td><p>Extract datasets DataFrame from one or more Alyx dataset records.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.ensure_list" title="one.util.ensure_list"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ensure_list</span></code></a></p></td>
<td><p>Ensure input is a list.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.filter_datasets" title="one.util.filter_datasets"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filter_datasets</span></code></a></p></td>
<td><p>Filter the datasets cache table by the relative path (dataset name, collection and revision).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.filter_revision_last_before" title="one.util.filter_revision_last_before"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filter_revision_last_before</span></code></a></p></td>
<td><p>Filter datasets by revision, returning previous revision in ordered list if revision doesn't exactly match.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.index_last_before" title="one.util.index_last_before"><code class="xref py py-obj docutils literal notranslate"><span class="pre">index_last_before</span></code></a></p></td>
<td><p>Returns the index of string that occurs directly before the provided revision string when lexicographic sorted.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.parse_id" title="one.util.parse_id"><code class="xref py py-obj docutils literal notranslate"><span class="pre">parse_id</span></code></a></p></td>
<td><p>Ensures the input experiment identifier is an experiment UUID string.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.patch_cache" title="one.util.patch_cache"><code class="xref py py-obj docutils literal notranslate"><span class="pre">patch_cache</span></code></a></p></td>
<td><p>Reformat older cache tables to comply with this version of ONE.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.refresh" title="one.util.refresh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">refresh</span></code></a></p></td>
<td><p>Refresh cache depending on query_type kwarg.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#one.util.ses2records" title="one.util.ses2records"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ses2records</span></code></a></p></td>
<td><p>Extract session cache record and datasets cache from a remote session data record.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.validate_date_range" title="one.util.validate_date_range"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_date_range</span></code></a></p></td>
<td><p>Validates and arrange date range in a 2 elements list.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#one.util.LazyId" title="one.util.LazyId"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LazyId</span></code></a></p></td>
<td><p>Using a paginated response object or list of session records, extracts eid string when required</p></td>
</tr>
</tbody>
</table>
<dl class="py data">
<dt class="sig sig-object py" id="one.util.QC_TYPE">
<span class="sig-name descname"><span class="pre">QC_TYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">CategoricalDtype(categories=['NOT_SET',</span> <span class="pre">'PASS',</span> <span class="pre">'WARNING',</span> <span class="pre">'FAIL',</span> <span class="pre">'CRITICAL'],</span> <span class="pre">ordered=True,</span> <span class="pre">categories_dtype=object)</span></em><a class="headerlink" href="#one.util.QC_TYPE" title="Link to this definition"></a></dt>
<dd><p>The cache table QC column data type.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.api.types.CategoricalDtype</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.Listable">
<span class="sig-name descname"><span class="pre">Listable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#Listable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.Listable" title="Link to this definition"></a></dt>
<dd><p>Return a typing.Union if the input and sequence of input.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.ses2records">
<span class="sig-name descname"><span class="pre">ses2records</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ses</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#ses2records"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.ses2records" title="Link to this definition"></a></dt>
<dd><p>Extract session cache record and datasets cache from a remote session data record.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ses</strong> (<em>dict</em>) – Session dictionary from Alyx REST endpoint.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>pd.Series</em> – Session record.</p></li>
<li><p><em>pd.DataFrame</em> – Datasets frame.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.datasets2records">
<span class="sig-name descname"><span class="pre">datasets2records</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/one/util.html#datasets2records"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.datasets2records" title="Link to this definition"></a></dt>
<dd><p>Extract datasets DataFrame from one or more Alyx dataset records.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> (<em>dict</em><em>, </em><em>list</em>) – One or more records from the Alyx ‘datasets’ endpoint.</p></li>
<li><p><strong>additional</strong> (<em>list</em><em> of </em><em>str</em>) – A set of optional fields to extract from dataset records.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Datasets frame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">datasets2records</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.parse_id">
<span class="sig-name descname"><span class="pre">parse_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#parse_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.parse_id" title="Link to this definition"></a></dt>
<dd><p>Ensures the input experiment identifier is an experiment UUID string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>method</strong> (<em>function</em>) – An ONE method whose second arg is an experiment ID.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A wrapper function that parses the ID to the expected string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>function</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – Unable to convert input to a valid experiment ID.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.refresh">
<span class="sig-name descname"><span class="pre">refresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#refresh"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.refresh" title="Link to this definition"></a></dt>
<dd><p>Refresh cache depending on query_type kwarg.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.validate_date_range">
<span class="sig-name descname"><span class="pre">validate_date_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">date_range)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'pandas._libs.tslibs.timestamps.Timestamp'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'pandas._libs.tslibs.timestamps.Timestamp'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#validate_date_range"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.validate_date_range" title="Link to this definition"></a></dt>
<dd><p>Validates and arrange date range in a 2 elements list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>date_range</strong> (<em>str</em><em>, </em><em>datetime.date</em><em>, </em><em>datetime.datetime</em><em>, </em><em>pd.Timestamp</em><em>, </em><em>np.datetime64</em><em>, </em><em>list</em><em>, </em><em>None</em>) – A single date or tuple/list of two dates.  None represents no bound.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The start and end timestamps.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of pd.Timestamp</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">)</span>  <span class="c1"># On this day</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2022-01-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-01-30&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[D]&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">([</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">])</span>  <span class="c1"># from date</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">([</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>  <span class="c1"># from date</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_date_range</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2020-01-01&#39;</span><span class="p">])</span>  <span class="c1"># up to date</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – Size of date range tuple must be 1 or 2.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.filter_datasets">
<span class="sig-name descname"><span class="pre">filter_datasets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">revision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">revision_last_before</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">QC.FAIL</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_qc_not_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_unique</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wildcards</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#filter_datasets"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.filter_datasets" title="Link to this definition"></a></dt>
<dd><p>Filter the datasets cache table by the relative path (dataset name, collection and revision).
When None is passed, all values will match.  To match on empty parts, use an empty string.
When revision_last_before is true, None means return latest revision.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_datasets</strong> (<em>pandas.DataFrame</em>) – A datasets cache table.</p></li>
<li><p><strong>filename</strong> (<em>str</em><em>, </em><em>dict</em><em>, </em><em>None</em>) – A filename str or a dict of alf parts.  Regular expressions permitted.</p></li>
<li><p><strong>collection</strong> (<em>str</em><em>, </em><em>None</em>) – A collection string.  Regular expressions permitted.</p></li>
<li><p><strong>revision</strong> (<em>str</em><em>, </em><em>None</em>) – A revision string to match.  If revision_last_before is true, regular expressions are
not permitted.</p></li>
<li><p><strong>revision_last_before</strong> (<em>bool</em>) – When true and no exact match exists, the (lexicographically) previous revision is used
instead.  When false the revision string is matched like collection and filename,
with regular expressions permitted.</p></li>
<li><p><strong>qc</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><a class="reference internal" href="one.alf.spec.html#one.alf.spec.QC" title="one.alf.spec.QC"><em>one.alf.spec.QC</em></a>) – Returns datasets at or below this QC level.  Integer values should correspond to the QC
enumeration NOT the qc category column codes in the pandas table.</p></li>
<li><p><strong>ignore_qc_not_set</strong> (<em>bool</em>) – When true, do not return datasets for which QC is NOT_SET.</p></li>
<li><p><strong>assert_unique</strong> (<em>bool</em>) – When true an error is raised if multiple collections or datasets are found.</p></li>
<li><p><strong>wildcards</strong> (<em>bool</em>) – If true, use unix shell style matching instead of regular expressions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A slice of all_datasets that match the filters.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Filter by dataset name and collection</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="s1">&#39;.*spikes.times.*&#39;</span><span class="p">,</span> <span class="s1">&#39;alf/probe00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Filter datasets not in a collection</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Filter by matching revision</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="s1">&#39;spikes.times.npy&#39;</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">revision</span><span class="o">=</span><span class="s1">&#39;2020-01-12&#39;</span><span class="p">,</span> <span class="n">revision_last_before</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Filter by filename parts</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="s1">&#39;spikes&#39;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;times&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Filter by QC outcome - datasets with WARNING or better</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="n">qc</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Filter by QC outcome and ignore datasets with unset QC - datasets with PASS only</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="n">filter_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="n">qc</span><span class="o">=</span><span class="s1">&#39;PASS&#39;</span><span class="p">,</span> <span class="n">ignore_qc_not_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>It is not possible to match datasets that are in a given collection OR NOT in ANY collection.
e.g. filter_datasets(dsets, collection=[‘alf’, ‘’]) will not match the latter. For this you
must use two separate queries.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.filter_revision_last_before">
<span class="sig-name descname"><span class="pre">filter_revision_last_before</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">revision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_unique</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#filter_revision_last_before"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.filter_revision_last_before" title="Link to this definition"></a></dt>
<dd><p>Filter datasets by revision, returning previous revision in ordered list if revision
doesn’t exactly match.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> (<em>pandas.DataFrame</em>) – A datasets cache table.</p></li>
<li><p><strong>revision</strong> (<em>str</em>) – A revision string to match (regular expressions not permitted).</p></li>
<li><p><strong>assert_unique</strong> (<em>bool</em>) – When true an alferr.ALFMultipleRevisionsFound exception is raised when multiple
default revisions are found; an alferr.ALFError when no default revision is found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A datasets DataFrame with 0 or 1 row per unique dataset.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.index_last_before">
<span class="sig-name descname"><span class="pre">index_last_before</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">revisions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">revision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/one/util.html#index_last_before"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.index_last_before" title="Link to this definition"></a></dt>
<dd><p>Returns the index of string that occurs directly before the provided revision string when
lexicographic sorted.  If revision is None, the index of the most recent revision is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>revisions</strong> (<em>list</em><em> of </em><em>strings</em>) – A list of revision strings.</p></li>
<li><p><strong>revision</strong> (<em>None</em><em>, </em><em>str</em>) – The revision string to match on.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index of revision before matching string in sorted list or None.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">index_last_before</span><span class="p">([],</span> <span class="s1">&#39;2020-08-01&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.autocomplete">
<span class="sig-name descname"><span class="pre">autocomplete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">term</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_terms</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/one/util.html#autocomplete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.autocomplete" title="Link to this definition"></a></dt>
<dd><p>Validate search term and return complete name, e.g. autocomplete(‘subj’) == ‘subject’.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.ensure_list">
<span class="sig-name descname"><span class="pre">ensure_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#ensure_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.ensure_list" title="Link to this definition"></a></dt>
<dd><p>Ensure input is a list.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="one.util.LazyId">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LazyId</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#LazyId"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.LazyId" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></p>
<p>Using a paginated response object or list of session records, extracts eid string when required</p>
<dl class="py method">
<dt class="sig sig-object py" id="one.util.LazyId.ses2eid">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ses2eid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ses</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/one/util.html#LazyId.ses2eid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.LazyId.ses2eid" title="Link to this definition"></a></dt>
<dd><p>Given one or more session dictionaries, extract and return the session UUID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ses</strong> (<em>one.webclient._PaginatedResponse</em><em>, </em><em>dict</em><em>, </em><em>list</em>) – A collection of Alyx REST sessions endpoint records.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>One or more experiment ID strings.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, list</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.cache_int2str">
<span class="sig-name descname"><span class="pre">cache_int2str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/one/util.html#cache_int2str"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.cache_int2str" title="Link to this definition"></a></dt>
<dd><p>Convert int ids to str ids for cache table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>table</strong> (<em>pd.DataFrame</em>) – A cache table (from One._cache).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="one.util.patch_cache">
<span class="sig-name descname"><span class="pre">patch_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_api_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/one/util.html#patch_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#one.util.patch_cache" title="Link to this definition"></a></dt>
<dd><p>Reformat older cache tables to comply with this version of ONE.</p>
<p>Currently this function will 1. convert integer UUIDs to string UUIDs; 2. rename the ‘project’
column to ‘projects’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table</strong> (<em>pd.DataFrame</em>) – A cache table (from One._cache).</p></li>
<li><p><strong>min_api_version</strong> (<em>str</em>) – The minimum API version supported by this cache table.</p></li>
<li><p><strong>name</strong> (<em>{'dataset'</em><em>, </em><em>'session'} str</em>) – The name of the table.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="one.tests.util.html" class="btn btn-neutral float-left" title="one.tests.util" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="one.util.QC_TYPE.html" class="btn btn-neutral float-right" title="one.util.QC_TYPE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, International Brain Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>